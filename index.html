<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Тендерики|Налаштування</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>

<header class="bg-gray-800 text-white p-4 flex justify-between items-center">
    <h1 class="text-xl font-bold sm:text-7xl">My Responsive Page</h1>
</header>
<main class="container mx-auto px-4 py-8 sm:text-6xl">
    <p class="text-gray-700 mb-4">This is a paragraph with some content. It will adapt its size and layout based on the screen size.</p>
    <ul class="list-none">
        <li class="flex items-center mb-2">
            <input type="checkbox" class="mr-2 accent-blue-500 sm:w-12 sm:h-12" id="04059243" name="04059243">
            <label for="04059243">Checkbox 1</label>
        </li>
        <li class="flex items-center mb-2">
            <input type="checkbox" class="mr-2 accent-blue-500 sm:w-12 sm:h-12" id="04805918" name="04805918">
            <label for="04805918">Checkbox 2</label>
        </li>
    </ul>
</main>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
    const checkboxes = document.querySelectorAll("input[type='checkbox']");

    loadSavedCheckboxes();
    // Init TWA
    Telegram.WebApp.ready();
    Telegram.WebApp.setBackgroundColor('#FFFFFF');

    // Show main button
    Telegram.WebApp.MainButton.setParams({
        text: 'Зберегти'
    });
    Telegram.WebApp.MainButton.onClick(function () {
        Telegram.WebApp.showAlert('Main Button was clicked ' + Telegram.WebApp.initDataUnsafe.user.id);

        const checkboxes = document.querySelectorAll("input[type='checkbox']");

        // Create an empty array to store checked values
        const checkedValues = [];

        // Loop through checkboxes and collect IDs of checked ones
        for (const checkbox of checkboxes) {
            if (checkbox.checked) {
                checkedValues.push(checkbox.id);
            }
        }

        console.log(checkedValues);

        const xhr = new XMLHttpRequest();
        xhr.open("POST", "https://nwz4qklmtt.sharedwithexpose.com/api/update-settings", true);  // Replace with your URL

        // Set request header (optional, but useful for some servers)
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

        // Function to handle successful response
        xhr.onload = function () {
            if (xhr.status === 200) {
                console.log("Response:", xhr.responseText);
                // Update UI or perform other actions here
            } else {
                console.error("Error:", xhr.statusText);
            }
        };

        // Function to handle errors
        xhr.onerror = function () {
            console.error("Error:", xhr.statusText);
        };

        const data = {
            checkedCheckboxes: checkedValues.join(","),
            userId: Telegram.WebApp.initDataUnsafe.user.id
        };

        const encodedData = `procuring_entities=${encodeURIComponent(data.checkedCheckboxes)}&user_id=${encodeURIComponent(data.userId)}`;

        // Send the AJAX request with encoded data
        xhr.send(encodedData);
    });

    Telegram.WebApp.MainButton.show();

    function loadSavedCheckboxes() {
        const xhr = new XMLHttpRequest();
        xhr.open("GET", "https://nwz4qklmtt.sharedwithexpose.com/api/get-settings?user_id=" + Telegram.WebApp.initDataUnsafe.user.id, true);  // Replace with your URL

        // Function to handle successful response
        xhr.onload = function() {
            if (xhr.status === 200) {
                const savedValues = JSON.parse(xhr.responseText);
                if (savedValues) {
                    for (const checkbox of checkboxes) {
                        checkbox.checked = savedValues.includes(checkbox.id);
                    }
                }
            } else {
                console.error("Error:", xhr.statusText);
            }
        };

        // Function to handle errors
        xhr.onerror = function() {
            console.error("Error:", xhr.statusText);
        };

        // Send the AJAX request
        xhr.send();
    }
</script>

</body>
</html>
